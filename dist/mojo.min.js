/*!
 * The MIT License
 * 
 * Copyright (c) 2011-2013 mojo Authors. All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
(function(d){var b=/\{([^\{\}]+)\}/g;function c(f){var g=b.exec(f),e=[],h=f,i=0;while(g!==null){h=f.substring(i,g.index);if(h){e.push(h);}e.push({rawKey:g[0],key:g[1]});i=b.lastIndex;g=b.exec(f);}if(i<f.length){e.push(f.substring(i));}return function(k){var n=[],m,j,l;if(!k){return e.join("");}for(m=0,j=e.length;m<j;m++){l=e[m];if(typeof(l)==="string"){n[n.length]=l;}else{n[n.length]=a(l.key,k);}}return n.join("");};}function a(h,l){var g,e,m,k=h.split("."),f=l,j;for(g=0,e=k.length;g<e;g++){j=f;m=f[k[g]];if(m==null){break;}else{f=m;}}if(!m&&g<e){return"";}m=m||f;if(typeof m==="function"){return m.call(j);}else{return m;}}d.template=function(g){var e=g,f=c(g);return{template:e,process:function(h){return f(h);}};};d.extension("template",function(){return d.template(this.html());});})(h5);(function(f){var c={listClass:"list",itemClass:"list-item",data:[],selectedIndex:-1,template:null,render:null,onselectionchange:function(j,k){}},h=f.isTypeOf,i=f.forEach,a=f.uuid,g="uiItem",b="model",d="ontouchstart" in document.documentElement?"tap":"click";function e(p,q,o,n){var j=document.createElement("li"),m=f(j),l,k;m.data(b,q);if(n.itemClass){i(n.itemClass,function(r){m.addClass(r);});}l=n.render(p,m,o,q);k=m.get(0);if(!k.id){k.id="itm"+a();}if(!m.html()){if(h(l,"String")){m.html(l);}else{m.append(l);}}m.data(g,m);return m;}f.extension("datalist",function(z){var j=f.extend({},c,z),p=(j.data||[]).slice(0),n,u,w,l,y=j.listClass,t=true,o=this.get(0),s,q;j.listClass=y=y?y.split(" "):null;j.itemClass=j.itemClass?j.itemClass.split(" "):null;j.render=j.render||function(D,C,A,B){return j.template?j.template.process(B):B+"";};function k(B){u=[];w.html("");if(p&&p.length){var A=document.createDocumentFragment();i(p,function(C,D){var E=e(q,C,D,j);A.appendChild(E.get(0));u[u.length]=E;if(D===B){n=E;E.addClass("selected");}});w.append(A);}}function v(C){var A=null,B;if(n){A=n;if(n===C){return;}}n=C;B=j.onselectionchange.call(q,C,A);if(B!==false){if(A){A.removeClass("selected");}n=C;if(n){n.addClass("selected");}}else{n=A;}}function r(D,A){var C,B;A=Number(A);if(isNaN(A)||A<0||A>p.length+1){return;}C=e(q,D,A,j);if(A===p.length){w.append(C);}else{B=u[A];B.before(C);}u.splice(A,0,C);p.splice(A,0,D);}function x(A){var C,B;A=Number(A);if(!isNaN(A)&&A>=0&&A<p.length){C=u.splice(A,1)[0];B=p.splice(A,1)[0];if(C&&B){w.remove(C.get(0));if(C===n){n=null;}}}}function m(B){var A=[];i(p,function(C,D){if(B(C)){A[A.length]=D;}});i(A,function(C){x(C);});}if(o.tagName.toLowerCase()==="ul"){w=this;s=w.get(0);}else{s=document.createElement("ul");this.append(s);w=f(s);}if(y){i(y,function(A){w.addClass(A);});}w.on(d,function(D){var A=D.target,B=A.parentNode,C;if(B===s){C=A;}else{while(B&&B!==s){C=B;B=B.parentNode;}}C=f(C).data(g);if(C){v(C);}});q={getElement:function(){return w;},size:function(){return p.length;},setItems:function(A,B){w.html("");p=A||[];n=null;k(B);},insertItemAt:function(B,A){if(typeof A==="undefined"){A=p.length;}r(B,A);},insertItem:function(A){r(A,p.length);},removeItemAt:function(A){x(A);},removeItems:function(A){if(typeof A==="function"){m(A);}},setEnabled:function(A){t=A===false?false:true;if(t){w.removeClass("disabled");}else{w.addClass("disabled");}},getItems:function(){return p.slice(0);},getSelectedItem:function(){return n;},getSelectedIndex:function(){var B,A;if(!n){return -1;}for(B=0,A=u.length;B<A&&u[B]!==n;B++){}return B===A?-1:B;},selectItemAt:function(B){var A=u.length;if(B<A&&B>=0){v(u[B]);}},setItemAt:function(A,B){var D=u[A],C;if(D){p[A]=B;D.data(b,B);C=j.render(q,D,A,B);if(C){if(h(C,"String")){D.html(C);}else{D.append(C);}}}},clearSelection:function(){v(null);}};l=w.find("li:nth-child(n+1)");if(l.count()){u=p=[];l.forEach(function(A,B){var C=f(A);C.data(g,C);C.data(b,C);u[u.length]=C;if(C.hasClass("selected")){n=C;}});}else{k(j.selectedIndex);}return q;});})(h5);(function(c){var b="ontouchstart" in document.documentElement?"tap":"click",a=function(){};c.extension("toggle",function(g){g=g||{};var i=!!g.value,f=this,d=g.onchange||a,h;function e(){if(i){f.addClass("on");}else{f.removeClass("on");}}f.on(b,function(){i=!i;e();d.call(h,i);});e();h={toggle:function(){i=!i;e();},setOn:function(j){i=!!j;e();},isOn:function(){return i;},getValue:function(){return i;}};return h;});})(h5);(function(f,d){if(f.mojo){return;}var e=d.forEach,b=f.document.createElement("div").style,c=false,g={"":"transitionend",Webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"},a,i=("onhashchange" in f),h={};(function(){e(g,function(j,k){if(typeof b[k+"Transition"]!=="undefined"){a=j;c=true;}});if(!c){a="transitionend";}}());h.Application=function(){var o=function(){},w={startView:"main",hideUrlBar:true},n,u={},t=[],v,l,p=["initialize","activate","deactivate","destroy"],y={initialize:o,activate:o,deactivate:o,destroy:o};function m(){return y;}function D(F){e(p,function(G){var H=F[G];if(!H){F[G]=o;}});}function r(H){for(var G=0,F=t.len;G<F&&t[G]!==H;G++){}return G===F?-1:G;}function A(F){if(!F){return null;}var G=F.lastIndexOf("#view:");if(G===-1){return null;}return F.substring(G+6);}function k(J,I,H){var G=I.ui=d("#"+J),F;if(!G.count()){delete u[J];throw new Error("Wrapper element for "+J+" not found");}G.on(a,I.overlay?z:B);F=I.controller=I.factory(v,G);D(F);F.initialize(H);}function C(L,J){var H=u[L],K,G,F=t.length,I=F?t[F-1]:null;if(I===L){return;}if(!H){throw new Error("No such view: "+L);}if(!H.ui){k(L,H,J);}K=H.ui;H.controller.activate(J);if(K.hasClass("out")){K.removeClass("transition").removeClass("out");}K.addClass("showing");setTimeout(function(){if(I){G=u[I];G.controller.deactivate();G.ui.addClass("out").removeClass("in");if(!c){G.ui.dispatch("transitionend");}}K.addClass("transition").addClass("in");if(!c){K.dispatch("transitionend");}},100);t.push(L);}function q(J){var H,I,G,F=t.length;if(F===1){console.log("Can't pop, last in stack");return;}G=u[t.pop()];H=u[t[F-2]];I=H.ui;H.controller.activate(J);if(!I.hasClass("out")&&!I.hasClass("transition")){I.addClass("transition").addClass("out");}I.addClass("showing");setTimeout(function(){G.controller.deactivate();G.ui.removeClass("in").addClass("pop");I.removeClass("out").addClass("in");if(!c){G.ui.dispatch("transitionend");}},100);}function E(G,F){}function x(F){}function B(H){var K=H.target,F=K.id,I=u[F],G,J;if(!I){return;}J=I.ui;G=I.controller;if(J.hasClass("out")){J.removeClass("showing");l.dispatch("viewtransitionout",{view:F});}if(J.hasClass("pop")){J.removeClass("showing").removeClass("transition").removeClass("pop");l.dispatch("viewtransitionout",{view:F});}if(J.hasClass("in")){f.location.hash="view:"+F;l.dispatch("viewtransitionin",{view:F});}}function z(F){}function s(){var F=t.length;return F?t[F-1]:null;}function j(J,G,H){var I,F=u[J];F=u[J];if(F){throw new Error("View "+J+" already exists");}I={id:J,ui:null,controller:null,overlay:!!H,factory:G||m};u[J]=I;}(function(){var F=null,G=f.location.href;d(f).on("hashchange",function(K){F=G;G=f.location.href;var H=n.startView,M=A(G)||H,J=A(F)||H,I=s(),L;if(!u[M]){return;}if(I!==M){L=t[t.length-2];if(L===M){q();}else{C(M);}}});})();v={registerView:function(G,F){j(G,F);},showView:function(G,F){C(G,F);},getViewPort:function(){return l;},loadView:function(H,F,G){if(u[H]){G(H);return;}d.xhr({url:F,method:"GET",dataType:"text",success:function(M){var K=d(M),I=K.find("script"),J,L=[];I.forEach(function(N){var P=d(N),O=P.attr("type");if(!P.attr("src")&&(!O||O.indexOf("/javascript")!==-1)){K.remove(N);L[L.length]=N;}});l.append(K);J=d("#"+H);e(L,function(N){var O=document.createElement("script");O.textContent=N.textContent;J.append(O);});if(G){G(H);}}});},popView:function(F){q(F);},getCurrentViewId:s,initialize:function(H){var G,F=f.document.body;n=d.extend({},w,H);G=n.viewPort;l=G?d("#"+G):d(F);C(n.startView);}};return v;};f.mojo=h;})(window,h5);
<!DOCTYPE html>
<html>
   <head>
      <title></title>      
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
      <meta name="HandheldFriendly" content="True" />
      <meta name="MobileOptimized" content="480" />
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
      
      <meta name="apple-mobile-web-app-capable" content="yes" />

      <meta http-equiv="cleartype" content="on" />

      <link rel="stylesheet" type="text/css" href="css/mojo-icons.css" />
      
      <!-- Combined mojo.less and app.less -->
      <link rel="stylesheet" type="text/css" href="css/app.css" />

      <!--[if lt IE 9]>
         <script src ="js/json2.js"> </script>
         <script src ="js/html5shiv.js"> </script>
      <![endif]-->

      <!-- script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?libraries=places&sensor=false"></script -->

      <!-- for older safaris -->
      <script>
          if(typeof JSON === "undefined") {
              (function script(src) {
                  var doc = document, s = doc.createElement("script"), fs = doc.getElementsByTagName("script")[0];
                  s.src = src;
                  s.async = 1;
                  fs.parentNode.insertBefore(s, fs);
                  return script;
              })("js/json2.js")("js/html5shiv.js");
          }
      </script>

      <script src ="js/h5.js"> </script>
      <!--[if lt IE 9]>
         <script src ="js/event_ie.js"> </script>
      <![endif]-->

      <script src ="js/mojo.js"> </script>
      <script src ="js/app.js"> </script>
   </head>

   <!-- Don't keep body as the view-port on android devices cause the views don't scroll -->
   <body>
      <div class="appmenu alt-bg">
         <ul class="pad-extra list">
            <li><span class="icon-cog-2"> Settings</span></li>
            <li><span class="icon-logout"> Logout</span></li>
         </ul>
      </div>
      <div class="viewport" id="viewPort">
         <div id="messages" class="messages hidden"></div>
         <div class="icon-hourglass" id="loading">Please wait...</div>


         
         
         <!-- ====================================== Tab View ========================================== -->
         <article class="view" id="tabView">
            <div class="toolbar">
               <span data-action="toggleMainMenu" class="activable action icon-menu"></span>
               <span class="title">Main</span>

               <span data-action="logout" class="activable action icon-logout right"></span>
               
               <span data-action="route" 
                     data-template="views/time.html" 
                     data-path="/ui/time"
                     class="activable action icon-clock right"></span>
               <span data-action="route" 
                     data-template="views/calendar.html" 
                     data-path="/ui/calendar"
                     class="activable action icon-calendar right"></span>
                     
               
               <!--span data-action="route" 
                     data-template="views/newView.html" 
                     data-path="/newView"
                     class="activable active-text action icon-plus right"></span -->
            </div>
            <div class="content">
               <ul id="mainTab" class="tabstrip alt-bg">
                  <li class="tab activable" data-ref="#tabOne"><span>Tab One</span></li>
                  <li class="tab activable" data-ref="#tabTwo"><span>Tab Two</span></li>
                  <li class="tab activable" data-ref="#tabThree"><span>Tab Three</span></li>
               </ul>
               <div>
                  <div class="tab-content" id="tabOne">
                     <span class="pad">Contents of Tab One</span>
                  </div>
                  
                  <div class="tab-content" id="tabTwo">
                     <!-- Sample List -->
                     <ul class="no-border" id="uiList"></ul>
                  </div>
                  
                  <div class="tab-content" id="tabThree">
                     <span class="pad">Contents of Tab Three</span>
                  </div>
               </div>
            </div>
            
            <!-- List Item Template -->
            <script id="uiListItemTemplate" type="text/template">
               <div class="box pad-vertical">
                  <p class="title">
                     {title}
                  </p>
                  <p class="desc left">
                     {description}
                  </p>
               </div>
            </script>

            <script defer>
               Application.addRoute("/tabView", {
                  id: "#tabView",
                  factory: function(app, viewUi) {
                     
                     var uiList, uiListItemTemplate, mainTab;

                     return {
                        initialize: function() {
                           // configure the toolbar
                           viewUi.find(".toolbar").toolbar({
                               refresh: function() {
                                  Messages.info("Refreshing...");
                               },
                               logout: function() {
                                  if(window.confirm("Log out?")) {}
                               }
                           });

                           // list item rendering template
                           uiListItemTemplate = $("#uiListItemTemplate").template();

                           // list widget
                           uiList = $("#uiList").datalist({
                              selectable: true,
                              itemClass: "activable",
                              render: function(list, item, i, itemModel) {
                                 item.html(uiListItemTemplate.process(itemModel))
                              }
                           });
                           
                           var arrItems = [];
                           for(var i = 0; i < 100; i++) {
                              arrItems[arrItems.length] = {
                                 title: "Item " + i, 
                                 description: "Description for Item " + i
                              };
                           }
                           uiList.setItems(arrItems);
                           
                           uiList.on(Events.tap, function(e, item, itemModel) {
                              // Messages.info(itemModel.description);
                           });

                           // tabstrip widget
                           mainTab = $("#mainTab").tabstrip({
                              ontabchange: function(currTab, oldTab) {
                                 // Messages.info("Tab selected: " + this.getSelectedIndex());
                              }
                           });
                        },

                        activate: function(routeParams, data) {
                        }
                     };
                  }
               });
            </script>
         </article>





         <!-- ===================================== Calendar View ======================================== -->
         <article class="view" id="calendarView">
            <section class="calendar">
               <div class="year-bar">
                  <span data-action="prev" class="years-previous box activable left icon-left-open"></span>
                  <ul class="left years horizontal no-border years"></ul>
                  <span data-action="next" class="years-next box activable right icon-right-open"></span>
               </div>
               <ul class="box list no-border months"></ul>
               <ul class="box list pad alt-bg no-border days"></ul>
               <ul class="box list pad dates"></ul>
            </section>
            <section class="cal-actions">
               <div class="left half pad">
                  <span data-action="ok" class="button primary icon-ok">OK</span>
               </div>
               <div class="right half pad">
                  <span data-action="cancel" class="button icon-cancel">Cancel</span>
               </div>
            </section>
            <script defer>
               Application.addRoute("/ui/calendar", {
                  id: "#calendarView",
                  factory: function(app, viewUi) {
                     var actYearsPrevious, actYearsNext, uiYears, uiMonths, uiDates, uiDays,

                        months = [
                           "JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"
                        ],
                        days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],

                        calData,
                        calDate;

                     function getLastDay(month, year) {
                        var day = 30;
                        switch (month)  {
                           case "Jan":
                           case "Mar":
                           case "May":
                           case "Jul":
                           case "Aug":
                           case "Oct":
                           case "Dec":
                           case 0:
                           case 2:
                           case 4:
                           case 6:
                           case 7:
                           case 9:
                           case 11:
                              day = 31;
                              break;
                           case "Feb":
                           case 1:
                              if(year % 4 === 0 && year % 100 !== 0 || year % 400 === 0)  {
                                 day = 29;
                              }else  {
                                 day = 28;
                              }
                              break;
                           default:
                              day = 30;
                        }
                        return day;
                     }

                     function getDates(month, year) {
                        var dt = new Date(), daysInMonth = getLastDay(month, year),
                                dow,
                                date = dt.getDate(),
                                arrDates = [];

                        dt.setDate(1);
                        dt.setMonth(month);
                        dt.setFullYear(year);

                        dow = dt.getDay();

                        // set the date back to original
                        dt.setDate(date);

                        // console.log("Day of week: " + dow);

                        for(var i = 0; i < dow; i++) {
                           arrDates[arrDates.length] = "";
                        }
                        for(i = 1; i <= daysInMonth; i++) {
                           arrDates[arrDates.length] = i;
                        }

                        // console.log(arrDates);
                        return arrDates;
                     }

                     function updateCalendarData() {
                        var year = calDate.getFullYear(),
                                 month = calDate.getMonth();

                        // populate years
                        uiYears.setItems(getYearDataNext(year));
                        uiYears.selectItemAt(0);

                        // select the current month
                        uiMonths.selectItemAt(month);
                     }

                     function updateCalendarDates() {
                        var arrDates = getDates(calDate.getMonth(), calDate.getFullYear());
                        uiDates.setItems(arrDates);
                        uiDates.selectItemAt(arrDates.indexOf(calDate.getDate()));
                     }

                     function getYearDataNext(year) {
                        return [year, year + 1, year + 2, year + 3];
                     }

                     function getYearDataPrevious(year) {
                        // if(year > 4) seriously??
                        return [year - 3, year - 2, year - 1, year];
                     }

                     function navigateYears(e) {
                        var act = $(e.target).attr("data-action"),
                              yr = act === "prev" ? uiYears.getItemAt(0) : uiYears.getItemAt(uiYears.size() - 1),
                              years = act === "prev" ? getYearDataPrevious(yr) : getYearDataNext(yr),
                              currIdx = years.indexOf(calDate.getFullYear());
                      
                        uiYears.setItems(years);
                        if(currIdx !== -1) {
                           uiYears.selectItemAt(currIdx);
                        }
                     }

                     return {
                        initialize: function() {
                           // Years control -------------------------------------------------------

                           uiYears = $("#calendarView > .calendar > .year-bar > .years").datalist({
                              itemClass: "activable",
                              listClass: "",
                              onselectionchange: function(val, oldVal) {
                                 calDate.setFullYear(val);
                                 updateCalendarDates();
                              }
                           });

                           actYearsPrevious = $("#calendarView > .calendar > .year-bar > .years-previous");
                           actYearsPrevious.on(Events.tap, navigateYears);

                           actYearsNext = $("#calendarView > .calendar > .year-bar > .years-next");
                           actYearsNext.on(Events.tap, navigateYears);


                           // Months Control ------------------------------------------------------

                           uiMonths = $("#calendarView > .calendar > .months").datalist({
                              listClass: "alt-bg",
                              itemClass: "activable",
                              data: months,
                              onselectionchange: function() {
                                 var mon = uiMonths.getSelectedIndex();
                                 calDate.setMonth(mon);
                                 updateCalendarDates();
                              }
                           });


                           // Days Calendar --------------------------------------------------------

                           uiDays = $("#calendarView > .calendar > .days").datalist({
                              listClass: "alt-bg",
                              itemClass: "",
                              selectable: false,
                              data: days
                           });

                           uiDates = $("#calendarView > .calendar > .dates").datalist({
                              itemClass: "activable",
                              render: function(widget, item, i, day) {
                                 var tn = document.createTextNode(day);
                                 if(!day) {
                                    item.addClass("disabled");
                                    item.html("&#160;");
                                 }else {
                                    item.get(0).appendChild(tn);
                                 }
                              },
                              onselectionchange: function(newValue) {
                                 return !!newValue;
                              }
                           });

                           uiDates.on(Events.tap, function(e, item, date) {
                              if(date) {
                                 calDate.setDate(Number(date));
                              }
                           });


                           // Actions -----------------------------------------------------
                           $("#calendarView .cal-actions .button").on(Events.tap, function(e) {
                              var t = $(e.target), act = t.attr("data-action"),
                                    dt = new Date(); //, now = new Date(dt.getTime());
                              if(act === "cancel") {
                                  app.popView(calData);
                                  return;
                              }

                              dt.setFullYear(calDate.getFullYear());
                              dt.setMonth(calDate.getMonth());
                              dt.setDate(calDate.getDate());

                              /*
                              if(dt.getTime() < now.getTime()) {
                                  Messages.error("Can't take rydes in the past");
                                  return;
                              }
                              */
                              calData.date = dt;
                              app.popView(calData);
                           });

                        },

                        activate: function(params, data) {
                           calData = data || {}, calDate = calData.date ? new Date(calData.date.getTime()) : new Date();
                           updateCalendarData();
                        }
                     };
                  }
               });
            </script>
         </article>





         <!-- ====================================== Date Time View ====================================== -->
         <article class="view" id="timeView">
            <div class="toolbar">
               <span id="timeTitle" class="title">Select Time</span>
            </div>
            <div class="content time">
               <div class="column left text-center pad">
                  <strong class="label">Hr</strong>
                  <ul class="box pad list hours"></ul>
               </div>

               <div class="column left text-center pad">
                  <strong>Min</strong>
                  <ul class="box pad list minutes"></ul>
               </div>

               <div class="column left text-center pad">
                  <strong>&#160;</strong>
                  <ul class="box pad list ampm">
                     <li class="activable">AM</li>
                     <li class="activable selected">PM</li>
                  </ul>
               </div>

               <div class="left details text-center time-actions">
                  <h1 class="timebox" id="timeBox"></h1>
                  <div class="pad">
                     <span data-action="ok" class="button primary icon-ok">OK</span>
                  </div>
                  <div class="pad">
                     <span data-action="cancel" class="button icon-cancel">Cancel</span>
                  </div>
               </div>

            </div>
            <script defer>
               Application.addRoute("/ui/time", {
                  id: "#timeView",
                  factory: function(app, viewUi) {
                     var timeData, time,
                           arrHours = [12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
                           //arrMin = [0, 15, 30, 45],
                           arrMin = [0, 10, 20, 30, 40, 50],

                           uiTimeBox,
                           uiHours, uiMin, uiAmpm;


                     function timeRenderer(widget, item, i, value) {
                        if(value < 10) {
                           return "0" + value;
                        }
                        return value;
                     }

                     function handleTimeChanged() {
                        var hrs = uiHours.getSelectedValue(),
                              min = uiMin.getSelectedValue(),
                              ampm = uiAmpm.getSelectedValue();

                        if(ampm === "PM") {
                           if(hrs < 12) hrs = hrs + 12;
                        }else {
                           if(hrs === 12) hrs = 0;
                        }

                        updateModel(hrs, min);

                        if(hrs < 10) {hrs = "0" + hrs;}
                        if(min < 10) {min = "0" + min;}

                        uiTimeBox.html(hrs + ":" + min + " Hrs");
                     }

                     function updateModel(hrs, min) {
                        time.setHours(hrs);
                        time.setMinutes(min);
                     }

                     function updateUi(hrs, min) {
                        var ampmIdx = 0, hours = hrs;
                        if(hrs > 12) {
                           hours = hrs - 12;
                        }
                        if(hrs >= 12) {
                            ampmIdx = 1;
                        }
                        uiHours.selectItemAt(arrHours.indexOf(hours));

                        var minIdx = arrMin.indexOf(min);
                        if(minIdx === -1) {
                           uiMin.selectItemAt(0);
                        }else {
                           uiMin.selectItemAt(minIdx);
                        }
                        uiAmpm.selectItemAt(ampmIdx);
                     }

                     return {
                        initialize: function() {
                           uiHours = $("#timeView ul.hours").datalist({
                              itemClass: "activable",
                              data: arrHours,
                              render: timeRenderer,
                              onselectionchange: handleTimeChanged
                           });

                           uiMin = $("#timeView ul.minutes").datalist({
                              itemClass: "activable",
                              data: arrMin,
                              render: timeRenderer,
                              onselectionchange: handleTimeChanged
                           });

                           uiAmpm = $("#timeView ul.ampm").datalist({
                              onselectionchange: handleTimeChanged
                           });

                           uiTimeBox = $("#timeBox");


                           $("#timeView .time-actions .button").on(Events.tap, function(e) {
                              var t = $(e.target), act = t.attr("data-action");

                              if(act === "ok") {
                                  timeData.hours = time.getHours();
                                  timeData.minutes = time.getMinutes();
                              }
                              app.popView(timeData);
                           });
                        },

                        activate: function(params, data) {
                           timeData = data || {
                              title: "Select Time",
                              hours: 1,
                              minutes: 0
                           };
                           time = new Date();

                           $("#timeTitle").html(timeData.title)
                           time.setHours(timeData.hours);
                           time.setMinutes(timeData.minutes);
                           
                           // update the UI to reflect new time
                           updateUi(timeData.hours, timeData.minutes);
                        }
                     };
                  }
               });
            </script>
         </article>





         <!-- ======================================= Select View ======================================== -->
         <article class="view" id="selectListView">
            <div class="toolbar">
               <span data-action="back" class="activable action icon-left-open"></span>
               <span class="title" id="selectListTitle"></span>
            </div>
            <div class="content">
               <ul class="pad" id="selectList"></ul>
            </div>
            <script defer>
               Application.addRoute("/ui/select", {
                  id: "#selectListView",
                  factory: function(app, viewUi) {
                     var selectList, selectListTitle, itemTemplate, listData;
                     return {
                        initialize: function() {
                           // configure the toolbar
                           viewUi.find(".toolbar").toolbar();

                           selectListTitle = $("#selectListTitle");
                           selectList = $("#selectList").datalist({
                              selectable: true,
                              itemClass: "activable",
                              render: function(widget, item, itemIdx, objItem) {
                                 if(itemTemplate) {
                                    return itemTemplate.process({
                                       list: widget,
                                       item: item,
                                       index: itemIdx,
                                       model: objItem
                                    });
                                 }else {
                                    return "" + objItem;
                                 }
                              },
                              onselectionchange: function(objVal) {
                                 if(objVal) {
                                    app.popView({
                                       id: listData.id,
                                       selection: objVal,
                                       index: selectList.getSelectedIndex()
                                    });
                                 }
                              }
                           });

                           viewUi.on("transitionout", function() {
                              selectList.clearSelection();
                           });
                        },
                        activate: function(params, data) {
                           if(!data) {
                              return;
                           }
                           listData = data;
                           itemTemplate = listData.template;

                           var title = listData.title || "Select",
                                   items = listData.items || [],
                                   selectedIndex = Number(listData.selectedIndex) || -1;

                           selectListTitle.html(title);
                           selectList.setItems(items);
                           selectList.selectItemAt(selectedIndex);
                        }
                     };
                  }
               });
            </script>
         </article>
      </div>
   </body>
</html>
